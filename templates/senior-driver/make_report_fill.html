{% extends 'senior-driver/_base_page_driver.html'%}

{% block title %}Продовження звіту {% endblock %}

{% block content_page %}

    <div class="container-fluid">
        <h1 class="mt-4 text-center">Продовження створення звіту</h1>
        <div class="content-text">
            {% if machines %}
            <input type="button" onclick='history.back();' value="Назад"/>
            <form class="form-group" action="{% url 'driver:make-report-fill' %}" method="POST">
                {% csrf_token %}
                
                <input type="hidden" name="date" value="{{ date }}">
                <p>Дата {{date}}</p>

                {% for machine in machines %}
                <input type="hidden" name="choices" value="{{machine.id}}">
  
                <div class="form-row border border-dark rounded-lg p-5 col-md-6 mx-auto">
  
                  <div class="form-group">
                    <p><b>Машина {{machine.full_name}}</b></p>
                  </div>
                  <div class="form-group col-md-6">
                    <label for="motog{{machine.id}}">Мотогини</label>
                    <input type="number" name="motohour" class="form-control" id="motog{{machine.id}}"
                      placeholder="Мотогодини (у мото/год)" required>
                  </div>
                  <div class="form-group col-md-6">
                    <label for="fuel{{machine.id}}">Бензин</label>
                    <input type="number" step="0.1" name="fuel" class="form-control" id="fuel{{machine.id}}"
                      placeholder="Бензин (у літрах)" required>
                  </div>
  
                  <div class="custom-control custom-checkbox my-1">
  
                    {#  костыль, но работает. Hidden поле - для передачи на бек, #}
                    {#  должно идти перед основным чекбоксом. #}
                    {#  div с классом breakage_info - в одном диве с чекбоксом (для jquery) #}
  
                    <input type="hidden" value="off" name="breakage">
                    <input type="checkbox" value="on" name="breakage" class="breakage custom-control-input"
                      id="breakage{{machine.id}}">
                    <label class="custom-control-label" for="breakage{{machine.id}}">Поломка?</label>
  
                    <div class="breakage_info form-group col-md-12">
                      <label for="info_breakage{{machine.id}}">Інформація про поломку</label>
                      <textarea class="form-control col-md-12" name="breakage_info" id="info_breakage{{machine.id}}"
                        rows="3"></textarea>
  
                    </div>
                  </div>
                </div>
                {% endfor %}
                <input type="submit" class="btn btn-warning d-block mt-3" name="sendData" value="Відправити дані"> 
              </form>
            {% else %}
              <h3>Ви не вибрали машини, які будуть відображатись у звіті!</h3>
              <a href="{% url 'driver:make-report' %}" class="btn btn-warning">Перейти до вибору машин</a>
            {% endif %}
        </div>
    </div>
{% endblock content_page %}


{% block add_style %}
    <style>        
    </style>
{% endblock add_style %}


{% block add_js %}
    <script>
        $(document).ready(function ($) {
            $('input.breakage').change(function () {
  
              if ($(this).is(':checked')) {
                $(this).nextAll('div.breakage_info').show();
              }
              else {
                $(this).nextAll('div.breakage_info').hide();
              }
            }).change();
          });
    </script>
{% endblock add_js %}
    