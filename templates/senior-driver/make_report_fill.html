{% extends 'senior-driver/_base_page_driver.html'%}

{% block title %}Продовження звіту {% endblock %}

{% block content_page %}

    <div class="container-fluid">
        {% if machines %}

        <h1 class="mt-4 mb-6 text-center">Продовження створення звіту за {{date}}</h1>
        <div class="content-text">
            <p class="text-center"><a href="javascript:history.back()">повернутись до вибору машин</a></p>
            <p class="offset-1 pt-4 pb-4" style="font-size: larger;"><span style="font-weight: bold;" class="pr-4">3.</span> Заповніть дані по кожній обраній машині:</p>
            
            <form class="form-group" action="{% url 'driver:make-report-fill' %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="date" value="{{ date }}"> 
                <div class="col-8 mx-auto">
                    {% for machine in machines %}
                    <input type="hidden" name="choices" value="{{machine.id}}">
                    <div class="col-12 pb-4">
                        <div class="card">
                            <h5 class="card-header">Машина {{machine.full_name}}</h5>
                            <div class="card-body">
                                <div class="form-group row">
                                    <label for="motog{{machine.id}}" class="col-sm-3 col-form-label">Пройдено мотогодин:</label>
                                    <div class="col-sm-9">
                                        <input type="number" class="form-control" id="motog{{machine.id}}" name="motohour" placeholder="мото/год" required>
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="fuel{{machine.id}}" class="col-sm-3 col-form-label">Використано дизелю:</label>
                                    <div class="col-sm-9">
                                        <input type="number" step="0.1" class="form-control" id="fuel{{machine.id}}" name="fuel" placeholder="літри" required>
                                    </div>
                                </div>
                                <div class="form-group form-check pt-2">
                                    {#  костыль, но работает. Hidden поле - для передачи на бек, #}
                                    {#  должно идти перед основным чекбоксом. #}
                                    {#  div с классом breakage_info - в одном диве с чекбоксом (для jquery) #}
                                    <input type="hidden" value="off" name="breakage">
                                    <input type="checkbox" value="on" name="breakage" class="breakage form-check-input" id="breakage{{machine.id}}">
                                    <label class="form-check-label" for="breakage{{machine.id}}">Була несправність?</label>
                                    <div class="breakage_info"><br>
                                        <textarea class="form-control" name="breakage_info" id="info_breakage{{machine.id}}" rows="1" placeholder="Опишіть поломку..."></textarea>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="text-center">
                        <input type="submit"class="btn btn-primary mt-3" name="sendData" value="Відправити дані"> 
                    </div>
                    
                </div>
            </form>
            
        
            <!-- <form class="form-group" action="{% url 'driver:make-report-fill' %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="date" value="{{ date }}"> 

                {% for machine in machines %}
                <div class="alert">
                <input type="hidden" name="choices" value="{{machine.id}}">
  
                <div class="form-row border border-dark rounded-lg p-5 col-md-6 mx-auto">
  
                  <div class="form-group">
                    <p><b>Машина {{machine.full_name}}</b></p>
                  </div>
                  <div class="form-group col-md-6">
                    <label for="motog{{machine.id}}">Мотогини</label>
                    <input type="number" name="motohour" class="form-control" id="motog{{machine.id}}"
                      placeholder="Мотогодини (у мото/год)" required>
                  </div>
                  <div class="form-group col-md-6">
                    <label for="fuel{{machine.id}}">Дизельне паливо</label>
                    <input type="number" step="0.1" name="fuel" class="form-control" id="fuel{{machine.id}}"
                      placeholder="Дизель (у літрах)" required>
                  </div>
  
                  <div class="custom-control custom-checkbox my-1">
  
                    {#  костыль, но работает. Hidden поле - для передачи на бек, #}
                    {#  должно идти перед основным чекбоксом. #}
                    {#  div с классом breakage_info - в одном диве с чекбоксом (для jquery) #}
  
                    <input type="hidden" value="off" name="breakage">
                    <input type="checkbox" value="on" name="breakage" class="breakage custom-control-input"
                      id="breakage{{machine.id}}">
                    <label class="custom-control-label" for="breakage{{machine.id}}">Несправність?</label>
  
                    <div class="breakage_info form-group col-md-12">
                      <label for="info_breakage{{machine.id}}">Інформація про несправність</label>
                      <textarea class="form-control col-md-12" name="breakage_info" id="info_breakage{{machine.id}}"
                        rows="3"></textarea>
  
                    </div>
                  </div>
                </div>
              </div>
                {% endfor %}
                <input type="submit" class="btn btn-warning d-block mt-3" name="sendData" value="Відправити дані"> 
              </form> -->
            
            {% else %}
              <p class="offset-1 pt-5 pb-4 text-danger" style="font-weight: bold; font-size: larger;">Ви не вибрали машини, які будуть відображатись у звіті!</p>
              <a href="{% url 'driver:make-report' %}" class="offset-1 btn btn-primary">Перейти до вибору машин</a>
            {% endif %}
        </div>
    </div></div>
{% endblock content_page %}


{% block add_style %}
    <style>        
    </style>
{% endblock add_style %}


{% block add_js %}
    <script>
        $(document).ready(function ($) {
            $('input.breakage').change(function () {
  
              if ($(this).is(':checked')) {
                $(this).nextAll('div.breakage_info').show();
              }
              else {
                $(this).nextAll('div.breakage_info').hide();
              }
            }).change();
          });
    </script>
{% endblock add_js %}
    